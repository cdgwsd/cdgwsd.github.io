---
categories:
  - Spring Boot
---
# 注解

## @Configuration

从 Spring 3.0 开始，@Configuration 注解被用于定义配置类，它的主要作用是定义 bean 配置信息，这种方式被称为 `Java 配置`

被 @Configuration 标注的类需要满足以下条件

- 不可以是 final 类型
- 不可以是匿名类
- 嵌套的 @Configuration 必须是静态类

### proxyBeanMethods 属性

先来看一下 @Configuration 注解的源代码

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Configuration {
	@AliasFor(annotation = Component.class)
	String value() default "";
    
    boolean proxyBeanMethods() default true;
}
```

可以看到 @Configuration 被 @Componnet 进行标注，因此 @Configuration 注解具有 @Componnet 相同的功能，即将被标注的类做为组件注册进容器中

同时 @Configuration 注解又有一个独特属性 `proxyBeanMethods` 。<font color=red>该属性用于指定类中被 @Bean 标注的方法是否应该被代理，即当直接调用 @Bean 方法时，是否返回共享的 Bean 实例</font>。

- true：代理 @Bean 方法，默认值
- false：不代理

接下来通过实例进行说明：

- 配置类

  ```java
  @Configuration
  public class ConfigurationConfig {
      @Bean
      public Eoo eoo() {
          System.out.println("Eoo 实例化");
          Foo foo = foo();
          return new Eoo();
      }
  
      @Bean
      public Foo foo() {
          System.out.println("Foo 实例化");
          Foo foo = new Foo();
          return foo;
      }
  }
  ```

- 测试方法

  ```java
  @Test
  public void testConfigurationConfig(){
      AnnotationConfigApplicationContext ioc = new AnnotationConfigApplicationContext(ConfigurationConfig.class);
      Eoo eoo1 = ioc.getBean("eoo", Eoo.class);
      Eoo eoo2 = ioc.getBean("eoo", Eoo.class);
      System.out.println(eoo1 == eoo2);
      ConfigurationConfig configurationConfig = ioc.getBean("configurationConfig", ConfigurationConfig.class);
      Eoo eoo3 = configurationConfig.eoo();
      System.out.println(eoo3 == eoo1);
  }
  ```

- proxyBeanMethods = true

  ```
  Eoo 实例化
  Foo 实例化
  true
  true
  ```

- proxyBeanMethods = false

  ```xml
  Eoo 实例化
  Foo 实例化
  Foo 实例化
  true
  Eoo 实例化
  Foo 实例化
  false
  ```

  每次直接调用 @Bean 方法时都会产生一个新的对象

<font color=red>@Configuration 是一个特殊的 @Componnet，可以通过 `proxyBeanMethods` 指定 @Bean 方法是否被容器代理</font>

## @Bean

@Bean 注解标注的方法返回的对象将做为组件被注册进容器中

- 方法的返回值类型就是组件类型
- 默认方法名就是组件名

@Bean 注解可以与 @Scope 注解一起使用来定义 Bean 的作用域

```java
@Bean
@Scope("prototype")
public Eoo eoo() {
    System.out.println("Eoo 实例化");
    Foo foo = foo();
    return new Eoo();
}
```

@Bean 通常与 @Configuraion 一起使用，但也可以放在被 @Component 标注的类中。当 @ComponentScan 注解制定了被扫描的包及其子包时，@Bean 也可以作用在这些包的普通类里

## @Import

@Import 注解用于在 @Configuration 标注的类中导入其他配置类或者注册额外的 Bean 定义 。通过 @Import 注解，可以将一个或多个其他配置类引入到当前的配置类中，以便组织和管理Bean的配置信息

- 导入配置类：将其他的 @Configuration 注解的类导入当前配置类中，这样被导入的配置类中的 @Bean 定义也会被纳入当前配置类的上下文

  ```java
  @Configuration
  @Import({AnotherConfig.class, AdditionalConfig.class})
  public class AppConfig {
      // AppConfig 的 @Bean 定义...
  }
  ```

- 导入普通类： 将普通的非配置类导入到当前配置类中，Spring 会尝试自动检测并注册这些类为 Bean

  ```java
  @Configuration
  @Import({MyComponent.class, AnotherComponent.class})
  public class AppConfig {
      // AppConfig 的 @Bean 定义...
  }
  ```

## @Conditional

@Conditional 注解是 Spring 框架中的条件化配置注解，它允许根据特定的条件来决定是否创建一个或多个 bean。通过使用 @Conditional 注解，可以在配置类中根据运行时条件动态地包含或排除某些 bean 的定义

- 基于条件类的条件化配置

  ```java
  @Configuration
  @Conditional(MyCondition.class)
  public class MyConfig {
      // 根据条件 MyCondition 来配置 bean...
  }
  ```

  上述代码中，MyCondition 是一个实现了 Condition 接口的条件类，将根据条件类的 matches 方法返回 true 或 false 来决定是否应用该配置

- 基于条件注解的条件化配置：根据属性值决定是否应用配置

  ```java
  @Configuration
  @ConditionalOnProperty(name = "myapp.feature.enabled", havingValue = "true")
  public class FeatureConfig {
      // 根据属性条件来配置 bean...
  }
  ```

## @ImportResource

用于导入 XML 配置文件

```java
@Configuration
@ImportResource("classpath:application-context.xml")
public class AppConfig {
    // 这里可以添加其他的 Java 配置
}
```

导入了名为 application-context.xml 的 XML 配置文件。该 XML 文件中可能包含一些 bean 的定义、属性配置等信息

## @ConfigurationProperties

用于将配置文件中的属性映射到 Java 对象的属性上

- 配置文件

  ```properties
  myapp.name=test
  myapp.version=1.0.0
  ```

- Java 类

  ```java
  @Component
  @ConfigurationProperties(prefix = "myapp")
  public class MyAppProperties {
      private String name;
      private int version;
      // Getters and setters...
  }
  ```

`@ConfigurationProperties`注解支持嵌套属性，可以将一组相关的属性放在同一个类中，形成一个配置类

- 配置文件

  ```properties
  myapp.name=MyApp
  myapp.version=1
  myapp.dbSettings.url=jdbc:mysql://localhost:3306/mydb
  myapp.dbSettings.username=admin
  myapp.dbSettings.password=secret
  ```

- 配置类

  ```java
  @Component
  @ConfigurationProperties(prefix = "myapp")
  public class MyAppProperties {
      private String name;
      private int version;
      private DbSettings dbSettings;
      // Getters and setters...
  }
  
  public class DbSettings {
      private String url;
      private String username;
      private String password;
      // Getters and setters...
  }
  ```

当配置文件中的属性值发生变化时，`@ConfigurationProperties` 注解会自动将新值注入到相应的Java对象中，而无需重启应用

## AnnotationConfigWeApplicationContext

- refresh方法：https://blog.csdn.net/vnjohn/article/details/128825500
- register